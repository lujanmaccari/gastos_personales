{% extends 'base.html' %}

{% block title %}
  Categorías
{% endblock %}

{% block sectionTitle %}
  Nueva categoría
{% endblock %}

{% block content %}
<div class="px-4 md:px-20 lg:px-40 flex flex-1 justify-center py-5">
  <div class="layout-content-container flex flex-col flex-1">
    <form method="post">
      {% csrf_token %}

      <div class="flex flex-wrap justify-between gap-3 p-4">
        <div class="flex min-w-72 flex-col gap-3">
          <p class="text-zinc-400 text-base font-normal leading-normal">Personaliza tus categorías para un mejor seguimiento de los gastos.</p>
        </div>
      </div>

      <!-- Nombre -->
      <div>
        <label class="flex flex-col flex-1">
          <p class="text-[#0e171b] text-base font-medium leading-normal pb-2">Nombre de la categoría</p>
          <input name="nombre" class="form-input flex w-full min-w-0 flex-1 rounded-xl text-[#0e171b] bg-background-light dark:bg-background-dark focus:border-primary h-14 placeholder:text-[#4e7f97] dark:placeholder-zinc-500 p-[15px]" placeholder="Ej: Comida, Transporte" value="{{ form.nombre.value|default:'' }}" />
          {{ form.nombre.errors }}
        </label>
      </div>

      <div class="p-4">
        <!-- Íconos -->
        <div class="flex flex-row gap-4">
          <!-- Comida -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="comida" hidden />
            <i class="fas fa-utensils text-3xl"></i>
          </label>

          <!-- Transporte -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="transporte" hidden />
            <i class="fas fa-bus text-3xl"></i>
          </label>

          <!-- Hogar -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="hogar" hidden />
            <i class="fas fa-home text-3xl"></i>
          </label>

          <!-- Entretenimiento -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="entretenimiento" hidden />
            <i class="fas fa-film text-3xl"></i>
          </label>

          <!-- Gimnasio -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="gimnasio" hidden />
            <i class="fas fa-dumbbell text-3xl"></i>
          </label>

          <!-- Viaje -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="viaje" hidden />
            <i class="fas fa-plane text-3xl"></i>
          </label>

          <!-- Educación -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="educacion" hidden />
            <i class="fas fa-book text-3xl"></i>
          </label>

          <!-- Salud -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="salud" hidden />
            <i class="fas fa-heartbeat text-3xl"></i>
          </label>

          <!-- Mascotas -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="mascotas" hidden />
            <i class="fas fa-paw text-3xl"></i>
          </label>

          <!-- Regalo -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="regalo" hidden />
            <i class="fas fa-gift text-3xl"></i>
          </label>

          <!-- Compras -->
          <label class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border">
            <input type="radio" name="icono" value="compras" hidden />
            <i class="fas fa-shopping-bag text-3xl"></i>
          </label>
        </div>

        <div>
          <h3 class="text-[#0e171b] text-base font-medium leading-normal pb-2">Selecciona un color</h3>
          <div class="flex flex-row gap-4">
            <!-- Amarillo -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="amarillo" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#f9cb15">
                <div class="w-10 h-10 rounded-full" style="background-color: #f9cb15;"></div>
              </div>
            </label>
        
            <!-- Azul -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="azul" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#2596be">
                <div class="w-10 h-10 rounded-full" style="background-color: #2596be;"></div>
              </div>
            </label>
        
            <!-- Violeta -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="violeta" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#a789f7">
                <div class="w-10 h-10 rounded-full" style="background-color: #a789f7;"></div>
              </div>
            </label>
        
            <!-- Verde -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="verde" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#58df88">
                <div class="w-10 h-10 rounded-full" style="background-color: #58df88;"></div>
              </div>
            </label>
        
            <!-- Naranja -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="naranja" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#f89645">
                <div class="w-10 h-10 rounded-full" style="background-color: #f89645;"></div>
              </div>
            </label>
        
            <!-- Rosa -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="rosa" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#f177b6">
                <div class="w-10 h-10 rounded-full" style="background-color: #f177b6;"></div>
              </div>
            </label>
        
            <!-- Rojo -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="rojo" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#f47675">
                <div class="w-10 h-10 rounded-full" style="background-color: #f47675;"></div>
              </div>
            </label>
        
            <!-- Gris -->
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="color" value="gris" hidden />
              <div class="rounded-full p-1 color-wrapper" data-color="#eff3f3">
                <div class="w-10 h-10 rounded-full" style="background-color: #eff3f3;"></div>
              </div>
            </label>
          </div>
        
          <!-- Vista previa -->
          <div class="mt-4">
            <h3 class="text-[#0e171b] text-base font-medium leading-normal pb-2">Vista Previa</h3>
            <div class="flex items-center gap-4 w-full p-4 rounded-xl bg-zinc-100">
              <div class="flex items-center justify-center w-16 h-16 rounded-full shrink-0 vista-previa-color" style="background-color: {{ form.color.value|default:'#f87171' }};">
                <span class="material-symbols-outlined text-4xl text-white vista-previa-icon">{{ form.icono.value|default:'shopping_cart' }}</span>
              </div>
              <p class="text-[#0e171b] text-xl font-bold truncate vista-previa-nombre">{{ form.nombre.value|default:'Nombre' }}</p>
            </div>
          </div>
        </div>
        
        <script>
          document.addEventListener("DOMContentLoaded", function() {
            const previewIcon = document.querySelector('.vista-previa-icon');
            const previewContainer = document.querySelector('.vista-previa-color');
            const previewName = document.querySelector('.vista-previa-nombre');
            const nameInput = document.querySelector('input[name="nombre"]');
          
            // Actualizar vista previa del nombre
            if (nameInput && previewName) {
              nameInput.addEventListener('input', () => {
                previewName.textContent = nameInput.value || 'Nombre';
              });
            }
          
            // Íconos
            const iconInputs = document.querySelectorAll('input[name="icono"]');
            iconInputs.forEach(input => {
              const iconWrapper = input.parentElement;
          
              function updateIconBorder() {
                if (input.checked) {
                  iconWrapper.classList.add('border-4', 'border-sky-200', 'rounded-lg', 'p-1');
                } else {
                  iconWrapper.classList.remove('border-4', 'border-sky-200', 'p-1');
                }
              }
          
              // Click en ícono
              iconWrapper.addEventListener('click', () => {
                iconInputs.forEach(ic => {
                  ic.checked = false;
                  ic.parentElement.classList.remove('border-4', 'border-sky-200', 'p-1');
                });
                input.checked = true;
                updateIconBorder();
                updatePreviewIcon(input.value);
              });
          
              // Inicializar borde por defecto
              updateIconBorder();
            });
          
            // Colores
            const colorWrappers = document.querySelectorAll('.color-wrapper');
            colorWrappers.forEach(wrapper => {
              const input = wrapper.parentElement.querySelector('input[type="radio"]');
              const color = wrapper.getAttribute('data-color');
          
              function updateColorBorder() {
                if (input.checked) {
                  wrapper.style.border = `4px solid ${color}`;
                } else {
                  wrapper.style.border = 'none';
                }
              }
          
              // Click en color
              wrapper.parentElement.addEventListener('click', () => {
                colorWrappers.forEach(w => {
                  w.querySelector('div').style.border = 'none';
                  w.style.border = 'none';
                });
                input.checked = true;
                updateColorBorder();
                updatePreviewColor(wrapper);
              });
          
              // Inicializar borde por defecto
              updateColorBorder();
            });
          
            // Funciones de preview
            function updatePreviewIcon(value) {
              if (!previewIcon) return;
              previewIcon.className = 'material-symbols-outlined text-4xl text-white';
              switch(value) {
                case 'comida': previewIcon.textContent = 'restaurant'; break;
                case 'transporte': previewIcon.textContent = 'directions_bus'; break;
                case 'hogar': previewIcon.textContent = 'home'; break;
                case 'entretenimiento': previewIcon.textContent = 'movie'; break;
                case 'gimnasio': previewIcon.textContent = 'fitness_center'; break;
                case 'viaje': previewIcon.textContent = 'flight'; break;
                case 'educacion': previewIcon.textContent = 'school'; break;
                case 'salud': previewIcon.textContent = 'favorite'; break;
                case 'mascotas': previewIcon.textContent = 'pets'; break;
                case 'regalo': previewIcon.textContent = 'card_giftcard'; break;
                case 'compras': previewIcon.textContent = 'shopping_cart'; break;
                default: previewIcon.textContent = 'category';
              }
            }
          
            function updatePreviewColor(colorDiv) {
              if (previewContainer) previewContainer.style.backgroundColor = colorDiv.querySelector('div').style.backgroundColor;
            }
          
            // Selección por defecto al cargar
            const firstIconInput = iconInputs[0];
            if (firstIconInput) {
              firstIconInput.checked = true;
              firstIconInput.parentElement.classList.add('border-4', 'border-sky-200', 'rounded-lg', 'p-1');
              updatePreviewIcon(firstIconInput.value);
            }
          
            const firstColorInput = document.querySelector('input[name="color"]');
            if (firstColorInput) {
              firstColorInput.checked = true;
              const wrapper = firstColorInput.nextElementSibling;
              wrapper.style.border = `4px solid ${wrapper.getAttribute('data-color')}`;
              updatePreviewColor(wrapper);
            }
          });
          </script>
          
          
{% endblock %}
